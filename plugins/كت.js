let handler = m => m;

let currentCount = 1; 


async function isAdmin(m, conn) {
  if (!m.isGroup) return false;
  try {
    let groupMetadata = await conn.groupMetadata(m.chat);
    let participants = groupMetadata.participants;
    let admins = participants.filter(p => p.admin === 'admin' || p.admin === 'superadmin');
    return admins.some(admin => admin.id === m.sender);
  } catch (error) {
    console.error('Error fetching group metadata:', error);
    return false;
  }
}

function arabicToEnglishNumeral(arabicNumeral) {
  const arabicToEnglishMap = {
    '٠': '0', '١': '1', '٢': '2', '٣': '3', '٤': '4',
    '٥': '5', '٦': '6', '٧': '7', '٨': '8', '٩': '9'
  };
  return arabicNumeral.replace(/[٠-٩]/g, d => arabicToEnglishMap[d]);
}

handler.all = async function(m) {
  let names = [
    'لوفي', 'ناروتو', 'سابو', 'ايس', 'رايلي', 'جيرايا', 'ايتاتشي', 'ساسكي', 'شيسوي', 'يوهان',
    'غوهان', 'آيزن', 'فايوليت', 'نامي', 'هانكوك', 'ايتاتشي', 'روبين', 'كاكاشي', 'ريومو', 'ريمورو',
    'غوكو', 'غوغو', 'كيلوا', 'غون', 'كورابيكا', 'يوسكي', 'ايشيدا', 'ايتيشغو', 'ميناتو', 'رينجي',
    'جيمبي', 'انوس', 'سايتاما', 'نيزيكو', 'اوراهارا', 'تانجيرو', 'نويل', 'استا', 'يونو', 'لايت',
    'راينر', 'اثي', 'لوكاس', 'زاك', 'الوكا', 'ماها', 'زينو', 'سيلفا', 'رينغوكو', 'تينغن', 'ميتسوري',
    'تنغن', 'هولمز', 'فريزا', 'فريزر', 'غيومي', 'غيو', 'كينق', 'عبدول', 'علي بابا', 'عبدالله', 'اللحية البيضاء',
    'ترانكس', 'تشوبر', 'فرانكي', 'دوفلامينغو', 'كروكودايل', 'ايانوكوجي', 'موراساكيبارا', 'فيلو', 'فو',
    'هان', 'ثورز', 'ثورفين', 'ساي', 'ساسكي', 'سابيتو', 'ساسوري', 'كوراما', 'كابوتو', 'ناروتو', 'لي',
    'غاي', 'ساي', 'شيغاراكي', 'اول فور ون', 'اول مايت', 'تشيساكي', 'كيسامي', 'كيساكي', 'ايتاتشي', 'ايتاشي',
    'موتين روشي', 'بيل', 'نير', 'لوغ', 'لوفي', 'زورو', 'نامي', 'ماكي', 'ماي', 'شوكو', 'شيزوكو', 'ويس',
    'بو', 'بان', 'بولا', 'غوكو', 'غوتين', 'غوهان', 'مورو', 'سيل', 'فيجيتا', 'بيروس', 'ديو', 'جوتارو',
    'كيرا', 'لايت', 'غاتس', 'غارب', 'هيماواري', 'بوروتو', 'غاجيل', 'جيغن', 'ليو', 'هيكي', 'هاتشيمان',
    'ثوركيل', 'اشيلاد', 'صوفيا', 'ميدوريما', 'ميدوريا', 'ديكو', 'داكي', 'دابي', 'ليفاي', 'ايرين', 'ارمين',
    'ايروين', 'ميكاسا', 'هانجي', 'غابي', 'غابيمارو', 'هيتش', 'ريتش', 'ايلتا', 'توكا', 'كانيكي', 'ليوريو',
    'كورابيكا', 'نيترو', 'ميرويم', 'ماتشي', 'جيلال', 'ميستوغان', 'غون', 'هيسوكا', 'شالنارك', 'بولنارف',
    'كاكيوين', 'فيتان', 'كينشيرو', 'نوبوناغا', 'ريم', 'رين', 'راينر', 'رايلي', 'زينيتسو', 'ويليام', 'ويندي',
    'هوري', 'هيوري', 'هوريكيتا', 'اوروتشيمارو', 'جيرايا', 'شادو', 'تسونادي', 'هاشيراما', 'شويو',
    'توبيراما', 'هيروزين', 'ميناتو', 'هيناتا', 'شويو', 'لولوش', 'نانالي', 'سوزاكو', 'ميامورا', 'روبين',
    'جيمبي', 'ايتشيغو', 'اوريهيمي', 'روكيا', 'ماش', 'لانس', 'رينجي'
  ];

  let response;
  if (/^كت$/i.test(m.text)) {
    let selectedNames = [];
    for (let i = 0; i < currentCount; i++) {
      let randomIndex = Math.floor(Math.random() * names.length);
      selectedNames.push(`*${names[randomIndex]}*`);
    }
    response = selectedNames.join(', ');
  } else if (/^\.كت\s*([\د٠-٩]+)?/i.test(m.text)) {
    let isAdminUser = await isAdmin(m, conn);
    if (isAdminUser) {
      let match = m.text.match(/^\.كت\s*([\د٠-٩]+)?/i);
      let count = match[1] ? parseInt(arabicToEnglishNumeral(match[1])) : 1;
      if (count > 0 && count <= 100) {
        currentCount = count;
        response = `تم تحديث عدد الأسماء إلى ${count}`;
      } else {
        response = 'الرجاء إدخال رقم بين 1 و 100';
      }
    } else {
      response = 'هذا الأمر مخصص للمشرفين فقط.';
    }
  }

  if (response) {
    await conn.reply(m.chat, response, m);
  }

  return !0;
};

export default handler;